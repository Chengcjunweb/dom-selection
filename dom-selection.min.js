!function(root,factory){"function"==typeof define&&define.amd?define([],factory):"object"==typeof module&&module.exports?module.exports=factory():root.DOMSelection=factory()}(this,function(){"use strict";function nextNode(node,container){if(node.firstChild)return node.firstChild;for(;node;){if(node===container)return null;if(node.nextSibling)return node.nextSibling;node=node.parentNode}}function getRange(sel){return sel=sel||win.getSelection(),sel.rangeCount>0?sel.getRangeAt(0):null}function setRange(saved,sel){saved&&(sel=sel||win.getSelection(),sel.removeAllRanges(),sel.addRange(saved))}function getRect(sel){if(sel=sel||win.getSelection(),!sel.rangeCount)return!1;for(var range=sel.getRangeAt(0).cloneRange(),rects=range.getClientRects?range.getClientRects():[],i=0;i<rects.length;++i){var rect=rects[i];if(rect.left&&rect.top&&rect.right&&rect.bottom)return{left:parseInt(rect.left,10),top:parseInt(rect.top,10),width:parseInt(rect.right-rect.left,10),height:parseInt(rect.bottom-rect.top,10)}}return!1}function getNodes(range){if(range=range||getRange(),!range)return[];var node=range.startContainer,endNode=range.endContainer;if(node===endNode)return[node];for(var nodes=[];node&&node!==endNode;)nodes.push(node=nextNode(node));for(node=range.startContainer;node&&node!==range.commonAncestorContainer;)nodes.unshift(node),node=node.parentNode;return nodes}function getHTML(sel){if(sel=sel||win.getSelection(),!sel.rangeCount||sel.isCollapsed)return null;for(var len=sel.rangeCount,container=doc.createElement("div"),i=0;i<len;++i)container.appendChild(sel.getRangeAt(i).cloneContents());return container.innerHTML}function isCollapsed(sel){return(sel||win.getSelection()).isCollapsed}function collapseStart(sel){(sel||win.getSelection()).collapseToStart()}function collapseEnd(sel){(sel||win.getSelection()).collapseToEnd()}function isWithin(container,sel){return sel=sel||win.getSelection(),container.contains(sel.anchorNode)&&container.contains(sel.focusNode)}function forceWithin(container,sel){var range=doc.createRange();range.selectNodeContents(container),range.collapse(!1),setRange(range,sel)}function expandToWord(sel){if(sel=sel||win.getSelection(),sel.modify)collapseStart(sel),sel.modify("move","backward","word"),sel.modify("extend","forward","word");else if("Control"!==sel.type){var range=sel.createRange();range.collapse(!0),range.expand("word")}}function getCaretWord(sel){sel=sel||win.getSelection();var rng=getRange(sel);expandToWord(sel);var str=sel.toString();return setRange(rng),str}function isBackwards(sel){if(sel=sel||win.getSelection(),!isCollapsed(sel)){var range=doc.createRange();return range.setStart(sel.anchorNode,sel.anchorOffset),range.setEnd(sel.focusNode,sel.focusOffset),range.detach(),range.collapsed}}function forceInclude(sel){if(sel=sel||win.getSelection(),!isCollapsed(sel)){var dir=["forward","backward"];isBackwards(sel)&&dir.reverse(),sel.collapse(sel.anchorNode,sel.anchorOffset),sel.modify("move",dir[0],"character"),sel.modify("move",dir[1],"word"),sel.extend(sel.focusNode,sel.focusOffset),sel.modify("extend",dir[1],"character"),sel.modify("extend",dir[0],"word")}}var win=window,doc=document,ver="0.2.0";return{getRange:getRange,setRange:setRange,getRect:getRect,getNodes:getNodes,getHTML:getHTML,isCollapsed:isCollapsed,isBackwards:isBackwards,collapseStart:collapseStart,collapseEnd:collapseEnd,isWithin:isWithin,forceWithin:forceWithin,expandToWord:expandToWord,getCaretWord:getCaretWord,forceInclude:forceInclude,version:ver}});
